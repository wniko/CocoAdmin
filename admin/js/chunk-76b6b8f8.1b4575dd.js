(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-76b6b8f8"],{"1ec3":function(t,e,a){},"225c":function(t,e,a){"use strict";var n=a("1ec3"),o=a.n(n);o.a},"32db":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition-group",{staticClass:"upload-list",attrs:{tag:"ul",name:"el-list"}},t._l(t.files,(function(e){return a("li",{key:e.uid,class:["upload-list__item","is-"+t.getStatus(e),t.focusing?"focusing":""],on:{focus:function(e){t.focusing=!0},blur:function(e){t.focusing=!1},click:function(e){t.focusing=!1}}},[t._t("default",[a("div",{staticClass:"upload-list__item-name"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{staticClass:"type",attrs:{span:14}},[t.isApp(e.name)?a("svg-icon",{attrs:{"icon-class":"android"}}):a("svg-icon",{attrs:{"icon-class":"file"}}),t._v(" "+t._s(e.name)+" ")],1),a("el-col",{staticClass:"size",attrs:{span:10}},[t._v(" "+t._s(t._f("humanFileSize")(e.size))+" ")])],1)],1),a("label",{staticClass:"upload-list__item-status-label"},["success"===e.status&&"success"===e.hippoStatus?a("i",{class:{"el-icon-upload-success":!0,"el-icon-circle-check":!0}}):a("i",{class:{"el-icon-upload-fail":!0,"el-icon-warning-outline":!0}})]),"uploading"!==e.hippoStatus?a("i",{staticClass:"el-icon-close",on:{click:function(a){return t.$emit("remove",e)}}}):t._e(),"uploading"===e.status||"uploading"===e.hippoStatus?a("el-progress",{attrs:{"stroke-width":4,percentage:t.parsePercentage(e)}}):t._e()],{file:e})],2)})),0)},o=[],i=(a("b680"),a("ac1f"),a("1276"),function(t){return t.split(".").pop()}),s=function(t,e){var a=e?1e3:1024;if(Math.abs(t)<a)return t+" B";var n=e?["KB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],o=-1;do{t/=a,++o}while(Math.abs(t)>=a&&o<n.length-1);return t.toFixed(1)+" "+n[o]},r={name:"UploadList",data:function(){return{focusing:!1}},props:{files:{type:Array,default:function(){return[]}}},filters:{humanFileSize:function(t){return 0===t?"":s(t,!0)}},methods:{getStatus:function(t){return"success"===t.status&&"success"===t.hippoStatus?"success":"fail"===t.status||"fail"===t.hippoStatus?"fail":"normal"},getPercentage:function(t){return t.remote?t.hippoProgress:t.hippoProgress?.8*t.percentage+.2*t.hippoProgress:.8*t.percentage},parsePercentage:function(t){var e=this.getPercentage(t);return parseInt(e,10)},isApp:function(t){return"apk"===i(t)}}},l=r,c=(a("d51d"),a("2877")),p=Object(c["a"])(l,n,o,!1,null,null,null);e["a"]=p.exports},"5ed7":function(t,e,a){"use strict";var n=a("f20a"),o=a.n(n);o.a},8546:function(t,e,a){},b562:function(t,e,a){"use strict";a.d(e,"g",(function(){return o})),a.d(e,"a",(function(){return i})),a.d(e,"b",(function(){return s})),a.d(e,"e",(function(){return r})),a.d(e,"f",(function(){return l})),a.d(e,"c",(function(){return c})),a.d(e,"h",(function(){return p})),a.d(e,"d",(function(){return u}));var n=a("b775");function o(t){return Object(n["a"])({url:"/coco/app/store/list",method:"post",data:t})}function i(t){return Object(n["a"])({url:"/coco/app/delete",method:"post",data:t})}function s(t){return Object(n["a"])({url:"/coco/app/issue",method:"post",data:t})}function r(t){return Object(n["a"])({url:"/coco/app/start",method:"post",data:t})}function l(t){return Object(n["a"])({url:"/coco/app/stop",method:"post",data:t})}function c(t){return Object(n["a"])({url:"/coco/app/list",method:"post",data:t})}function p(t){return Object(n["a"])({url:"/coco/file/upload/progress",method:"post",data:t})}function u(t){return Object(n["a"])({url:"/coco/app/remote/upload",method:"post",data:t})}},c04a:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"upload-drawer",class:[{hover:t.hovering}],on:{mouseenter:function(e){t.hovering=!0},mouseleave:function(e){t.hovering=!1}}},[a("div",{ref:"control",staticClass:"upload-drawer-control",on:{click:function(e){t.isExpanded=!t.isExpanded}}},[a("transition",{attrs:{name:"arrow-slide"}},[a("i",{class:[t.iconClass,{hovering:t.hovering}]})]),a("transition",{attrs:{name:"text-slide"}},[a("span",{directives:[{name:"show",rawName:"v-show",value:t.hovering,expression:"hovering"}]},[t._v(t._s(t.controlText)+"上传进度")])])],1),a("div",{ref:"content",staticClass:"content"},[t._t("content")],2)])},o=[],i={name:"UploadDrawer",data:function(){return{hovering:!1,isExpanded:!0}},methods:{},computed:{iconClass:function(){return this.isExpanded?"el-icon-caret-bottom":"el-icon-caret-top"},controlText:function(){return this.isExpanded?"隐藏":"显示"},contentArea:function(){return this.$refs["content"]}},watch:{isExpanded:function(t){this.contentArea.style.height=t?"450px":"0",t||(this.$refs.control.style.left="0")}}},s=i,r=(a("5ed7"),a("2877")),l=Object(r["a"])(s,n,o,!1,null,"3672987a",null);e["a"]=l.exports},d51d:function(t,e,a){"use strict";var n=a("8546"),o=a.n(n);o.a},d6f3:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-dialog",{attrs:{visible:t.uploadDialogVisible,title:"上传应用",width:"480px","custom-class":"upload-dialog","close-on-click-modal":!1},on:{"update:visible":function(e){t.uploadDialogVisible=e},close:t.handleUploadDialogClose}},[a("div",{staticClass:"content"},[a("div",{staticClass:"tooltip"},[a("p",[t._v("文件名请不要包含空格、斜杠和中文等特殊字符")]),a("p",{staticStyle:{color:"#F56C6C"}},[a("i",{staticClass:"el-icon-warning",staticStyle:{"margin-right":"5px"}}),t._v("如本地上传速度较慢，建议使用APK下载地址进行上传")])]),a("div",{staticClass:"button"},[a("el-input",{attrs:{placeholder:"请输入APK下载地址",size:"small"},model:{value:t.uploadAppRemotePath,callback:function(e){t.uploadAppRemotePath=e},expression:"uploadAppRemotePath"}}),a("el-button",{style:{marginLeft:"10px"},attrs:{type:"primary",size:"small"},on:{click:t.handleAppRemoteUpload}},[t._v(" 确定 ")]),a("el-upload",{ref:"upload",attrs:{action:t.uploadAction,name:t.uploadName,data:t.uploadData,headers:t.uploadHeader,multiple:!1,"on-error":t.handleUploadError,"on-success":t.handleUploadSuccess,"on-change":t.handleUploadChange,"before-upload":t.handleBeforeUpload,"show-file-list":!1}},[a("el-button",{style:{marginLeft:"10px"},attrs:{type:"primary",size:"small"}},[t._v(" 本地上传 ")])],1)],1)])]),a("div",{staticClass:"filter-container"},[a("el-button",{staticClass:"filter-item",attrs:{size:"small",type:"primary"},on:{click:function(e){t.uploadDialogVisible=!0}}},[a("i",{staticClass:"el-icon-upload"}),t._v(" 上传应用 ")]),a("div",{staticStyle:{float:"right"}},[a("el-button",{staticClass:"filter-item",attrs:{size:"small",icon:"el-icon-refresh"},on:{click:t.getAppList}},[t._v(" 刷新 ")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.appListLoading,expression:"appListLoading"}],staticStyle:{"max-width":"880px"},attrs:{data:t.appList,border:"","highlight-current-row":"",size:"small"}},[a("el-table-column",{attrs:{label:"ID",prop:"id",width:"125",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",[t._v(t._s(n.appid))])]}}])}),a("el-table-column",{attrs:{label:"应用名称",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",[t._v(t._s(n.appname))])]}}])}),a("el-table-column",{attrs:{label:"应用包名",width:"250",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",[t._v(t._s(n.packagename))])]}}])}),a("el-table-column",{attrs:{label:"版本号",width:"150",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",[t._v(t._s(n.versionname))])]}}])}),a("el-table-column",{attrs:{label:"管理",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return t.handleAppStoreDelete(n)}}},[t._v(" 删除 ")])]}}])})],1),t.uploadList.length>0?a("upload-drawer",{ref:"uploadDrawer"},[a("upload-list",{attrs:{slot:"content",files:t.uploadList},on:{remove:function(e){return t.handleUploadListRemove(e)}},slot:"content"})],1):t._e()],1)},o=[],i=(a("99af"),a("a623"),a("4de4"),a("4160"),a("c975"),a("13d5"),a("fb6a"),a("45fc"),a("a434"),a("b0c0"),a("d3b7"),a("07ac"),a("ac1f"),a("25f0"),a("5319"),a("1276"),a("159b"),a("5530")),s=a("2f62"),r=a("c04a"),l=a("32db"),c=a("b562"),p=function(t){return t.split(".").pop()},u=function(){var t=(new Date).getTime(),e=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(a){var n=16*Math.random();return t>0?(n=(t+n)%16|0,t=Math.floor(t/16)):(n=(e+n)%16|0,e=Math.floor(e/16)),("x"===a?n:3&n|8).toString(16)}))},d={name:"AppStore",components:{UploadDrawer:r["a"],UploadList:l["a"]},data:function(){return{appListQuery:{appName:void 0},appListLoading:!1,appStoreList:[],uploadDialogVisible:!1,uploadAppRemotePath:"",uploadLocalList:[],uploadRemoteList:[],uploadName:"app",uploadAction:"".concat(location.protocol,"//").concat(location.host,"/coco/app/upload")}},computed:Object(i["a"])({},Object(s["b"])(["token","webName"]),{appList:function(){var t=this;return this.appStoreList.length>1?this.appStoreList[0].filter((function(e){return t.appStoreList.slice(1).every((function(t){return t.some((function(t){return t.packagename===e.packagename}))}))})):this.appStoreList},uploadList:function(){return this.uploadLocalList.concat(this.uploadRemoteList)},uploadData:function(){return{token:this.token}},uploadHeader:function(){return{token:this.token}}}),mounted:function(){var t=this;setTimeout((function(){t.getAppList()}),500)},methods:{handleAppListFilter:function(){},getAppList:function(){var t=this;this.appListLoading=!0,Object(c["g"])({token:this.token,isCommon:!0}).then((function(e){t.appListLoading=!1,t.appStoreList=e.data})).catch((function(){t.appListLoading=!1}))},updateHipppUploadProgress:function(t){var e=this;t.hippoStatus||this.$set(t,"hippoStatus","uploading"),t.hippoProgress||this.$set(t,"hippoProgress",0);var a=t.response.data,n={},o=setInterval((function(){100===t.hippoProgress||99===t.hippoProgress?(t.hippoStatus="success",e.getAppList(),clearInterval(o)):a.forEach((function(i){Object(c["h"])({fileId:i}).then((function(s){"00000"===s.code&&"uploading"===t.hippoStatus&&(s.data<0?(t.hippoStatus="fail",clearInterval(o),e.$confirm("".concat(t.name,"文件存在问题, 上传失败!"),"提示",{confirmButtonText:"确定",showCancelButton:!1,type:"error"})):(n[i]=s.data,t.hippoProgress=Object.values(n).reduce((function(t,e){return t+e}),0)/a.length))}))}))}),2e3)},handleUploadError:function(t,e,a){this.$message.error(e.name+"上传失败"),a.push(e)},handleUploadSuccess:function(t,e,a){var n=t.code;"00000"!==n?(this.$message.error(e.name+"上传失败 "+t.message),e.status="fail"):this.updateHipppUploadProgress(e)},handleUploadChange:function(t,e){this.uploadLocalList=e},handleBeforeUpload:function(t){return"apk"!==p(t.name)?(this.$message.warning("上传应用不是apk文件"),!1):/^[a-zA-Z0-9_\(\)\.\-]+$/.test(t.name)?t.name.length>50?(this.$message.warning("文件名过长"),!1):(this.$refs["uploadDrawer"]&&(this.$refs["uploadDrawer"].isExpanded=!0),this.uploadDialogVisible=!1,!0):(this.$message.warning("文件名不能包含特殊字符和中文"),!1)},handleUploadListRemove:function(t){t.remote||this.$refs["upload"].abort(t);var e=t.remote?this.uploadRemoteList:this.uploadLocalList;e.splice(e.indexOf(t),1)},handleAppRemoteUpload:function(){var t=this,e=this.uploadAppRemotePath.split("?")[0],a=e.split("/").pop();if(a)if("apk"===p(a))if(/^[a-zA-Z0-9_\(\)\.\-]+$/.test(a))if(a.length>50)this.$message.warning("文件名过长");else{var n={name:a,remote:!0,uid:u(),size:0,status:"success",hippoStatus:"uploading",hippoProgress:0};Object(c["d"])({token:this.token,fileName:a,fileUrl:this.uploadAppRemotePath}).then((function(e){n.response=e,t.updateHipppUploadProgress(n)})).catch((function(t){n.hippoStatus="fail"})),this.uploadRemoteList.push(n),this.$refs["uploadDrawer"]&&(this.$refs["uploadDrawer"].isExpanded=!0),this.uploadDialogVisible=!1}else this.$message.warning("文件名不能包含特殊字符和中文");else this.$message.warning("上传应用不是apk文件");else this.$message.warning("下载链接找不到文件")},handleUploadDialogClose:function(){this.uploadAppRemotePath=""},handleAppStoreDelete:function(t){var e=this,a=t.packagename;this.$confirm("删除后对已安装该应用的云机不受影响，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(c["a"])({token:e.token,deviceIdList:[],packageName:a}).then((function(t){e.$message.success("删除成功"),e.getAppList()}))})).catch((function(t){}))}}},f=d,h=(a("225c"),a("2877")),m=Object(h["a"])(f,n,o,!1,null,"2fbeaf0e",null);e["default"]=m.exports},f20a:function(t,e,a){}}]);